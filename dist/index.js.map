{"version":3,"sources":["../src/kanaToHangul.ts"],"names":["require","out","info"],"mappings":"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AAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAC9C,QAAG,EAAE,KAAK,UAAK,WAAW,KAAK,WAAW,IAAI;AAAA,IAE9C,QAAG,EAAE,KAAK,UAAK,WAAW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","sourcesContent":["// lib/kanaToHangul.ts\nimport kuromoji from \"kuromoji\";\nimport path from \"path\";\nimport { createRequire } from \"module\";\n\nconst require = createRequire(import.meta.url);\n\n/**\n * 1) normalize(NFC) + halfwidth-katakana NFKC + dash variants normalize\n * 2) katakana -> hiragana\n * 3) kuromoji로 \"助詞\"인 は/へ/を만 わ/え/お로 치환\n * 4) 기존 core 변환(모라/촉음/ん/장음 drop 등) 그대로 수행\n *\n * ✅ 핵심: は를 휴리스틱으로 때려맞추지 않고, \"품사=助詞\"일 때만 바꿉니다.\n *    - おねえさんは... / おかあさんは... / ひゃんは... => は는 助詞라 わ\n *    - いろはです => 'は'는 단어 일부(助詞 아님)라 그대로 하\n *    - 「...」はい。 => はい의 'は'는 助詞 아님(대개 感動詞/名詞/動詞 등)이라 그대로 하\n */\n\ntype Tokenizer = kuromoji.Tokenizer<kuromoji.IpadicFeatures>;\n\nasync function buildTokenizer(): Promise<Tokenizer> {\n  return new Promise((resolve, reject) => {\n    // dicPath를 \"node_modules/...\"로 박아두면 pnpm/모노레포/번들러에서 깨질 수 있어 resolve 기반 권장\n    const dicPath = path.join(require.resolve(\"kuromoji\"), \"..\", \"..\", \"dict\");\n\n    kuromoji.builder({ dicPath }).build((err, tk) => {\n      if (err || !tk) reject(err);\n      else resolve(tk);\n    });\n  });\n}\n\n// ⚠️ 라이브러리 내부 top-level await는 환경에 따라 골치아픔.\n//    앱/테스트에서 1회만 build 후 주입하는 방식을 권장.\nlet _tokenizer: Tokenizer | null = null;\nasync function getTokenizer(): Promise<Tokenizer> {\n  if (_tokenizer) return _tokenizer;\n  _tokenizer = await buildTokenizer();\n  return _tokenizer;\n}\n\n// --------------------\n// Public APIs\n// --------------------\n\nexport type KanaToHangul = (input: string) => string;\n\nlet _kanaToHangulInstance: KanaToHangul | null = null;\nlet _kanaToHangulInitPromise: Promise<KanaToHangul> | null = null;\n\nasync function initKanaToHangul(): Promise<KanaToHangul> {\n  if (_kanaToHangulInstance) return _kanaToHangulInstance;\n  if (_kanaToHangulInitPromise) return _kanaToHangulInitPromise;\n\n  _kanaToHangulInitPromise = (async () => {\n    const tk = await getTokenizer();\n    const convert: KanaToHangul = (input: string) =>\n      kanaToHangulWithTokenizer(input, tk);\n    _kanaToHangulInstance = convert;\n    return convert;\n  })();\n\n  return _kanaToHangulInitPromise;\n}\n\nexport async function kanaToHangul(input: string): Promise<string> {\n  const converter = await initKanaToHangul();\n  return converter(input);\n}\n\nexport const KanaBarum = Object.freeze({\n  init: initKanaToHangul,\n});\n\nfunction kanaToHangulWithTokenizer(\n  input: string,\n  tokenizer: Tokenizer,\n): string {\n  input = normalizeInput(input);\n  let s = normalizeToHiragana(input);\n  s = rewriteParticlesWithKuromoji(s, tokenizer);\n  return coreKanaToHangulConvert(s);\n}\n\n// --------------------\n// Step 1: normalization\n// --------------------\n\nfunction normalizeInput(input: string): string {\n  // 1) NFD 결합문자(が/ぱ 등) 합성\n  input = input.normalize(\"NFC\");\n\n  // 2) 반각 가타카나만 전각으로 (구두점/특수문자 최대한 보존)\n  input = normalizeHalfwidthKatakanaOnly(input);\n\n  // 3) 장음 기호 변종 최소 치환\n  // - U+2015 HORIZONTAL BAR\n  // - U+2500 BOX DRAWINGS LIGHT HORIZONTAL\n  input = input.replace(/[\\u2015\\u2500]/g, \"ー\");\n\n  // (원하면) FF70 'ｰ'도 halfwidth chunk에서 NFKC로 대부분 'ー'로 정규화됩니다.\n  return input;\n}\n\nfunction normalizeHalfwidthKatakanaOnly(s: string): string {\n  // ✅ 반각 가타카나 + 탁점/반탁점(ﾞﾟ) + 반각 장음(ｰ)까지 함께 NFKC\n  return s.replace(/[\\uFF66-\\uFF9F\\uFF70]+/g, (chunk) =>\n    chunk.normalize(\"NFKC\"),\n  );\n}\n\nfunction normalizeToHiragana(str: string): string {\n  let out = \"\";\n  for (const ch of str) {\n    const c = ch.codePointAt(0)!;\n    // カタカナ → ひらがな\n    if (c >= 0x30a1 && c <= 0x30f6) {\n      out += String.fromCodePoint(c - 0x60);\n      continue;\n    }\n    if (ch === \"ー\") {\n      out += ch;\n      continue;\n    }\n    out += ch;\n  }\n  return out;\n}\n\nfunction hiraToKata(hira: string): string {\n  const c = hira.codePointAt(0)!;\n  if (c >= 0x3041 && c <= 0x3096) {\n    return String.fromCodePoint(c + 0x60);\n  }\n  return hira;\n}\n\n// --------------------\n// Step 2: particle rewrite via kuromoji (NO heuristics)\n// --------------------\nconst HARD_BOUNDARY_SURF = new Set([\n  \"。\",\n  \"、\",\n  \"！\",\n  \"？\",\n  \"!\",\n  \"?\",\n  \" \",\n  \"　\",\n]);\nconst HARD_BOUNDARY_DETAIL1 = new Set([\n  \"句点\",\n  \"読点\",\n  \"括弧開\",\n  \"括弧閉\",\n  \"空白\",\n]);\n\nfunction isHardBoundaryToken(t: kuromoji.IpadicFeatures): boolean {\n  if (t.pos !== \"記号\") return false;\n  if (HARD_BOUNDARY_SURF.has(t.surface_form)) return true;\n  return HARD_BOUNDARY_DETAIL1.has(t.pos_detail_1 ?? \"\");\n}\n\n// emoji/로마자 같은 \"記号\"도 kuromoji가 찍어버리는 경우가 있어서,\n// \"문장부호\"만 boundary로 보고 나머지 記号는 content로 취급합니다.\nfunction isContentToken(t: kuromoji.IpadicFeatures): boolean {\n  if (t.pos === \"記号\") return !isHardBoundaryToken(t);\n  return true;\n}\n\nfunction prevContentIdx(tokens: kuromoji.IpadicFeatures[], i: number): number {\n  for (let j = i - 1; j >= 0; j--) if (isContentToken(tokens[j])) return j;\n  return -1;\n}\n\nfunction nextContentIdx(tokens: kuromoji.IpadicFeatures[], i: number): number {\n  for (let j = i + 1; j < tokens.length; j++)\n    if (isContentToken(tokens[j])) return j;\n  return -1;\n}\n\nfunction nextBoundaryOrEnd(\n  tokens: kuromoji.IpadicFeatures[],\n  i: number,\n): boolean {\n  // i 뒤에 남은 토큰이 전부 boundary(또는 없음)인 경우 true\n  for (let j = i + 1; j < tokens.length; j++) {\n    if (isHardBoundaryToken(tokens[j])) continue;\n    return false;\n  }\n  return true;\n}\n\nconst LEXICAL_HE_ENDINGS = [\n  \"いにしへ\",\n  \"おきへ\",\n  \"もとへ\",\n  \"すえへ\",\n  \"すゑへ\",\n  \"かみへ\",\n  \"くにへ\",\n  \"きしへ\",\n] as const;\n\n// 조사만 치환: は/へ/を (문맥 확정일 때만)\nexport function rewriteParticlesWithKuromoji(\n  s: string,\n  tokenizer: Tokenizer,\n): string {\n  const tokens = tokenizer.tokenize(s);\n\n  let out = \"\";\n\n  const isSingleKana = (x: string) =>\n    x.length === 1 && /^[\\u3040-\\u309F\\u30A0-\\u30FF]$/.test(x);\n\n  for (let i = 0; i < tokens.length; i++) {\n    const t = tokens[i];\n    const surf = t.surface_form;\n\n    let replaced = surf;\n\n    // -----------------\n    // は : topic marker (は -> わ)\n    // -----------------\n    if (t.pos === \"助詞\" && surf === \"は\") {\n      // ✅ \"はは\" 같은 반복(lexical) 보호: 앞/뒤가 바로 'は'면 변환 금지\n      if (i > 0 && tokens[i - 1].surface_form === \"は\") {\n        out += surf;\n        continue;\n      }\n      if (i + 1 < tokens.length && tokens[i + 1].surface_form === \"は\") {\n        out += surf;\n        continue;\n      }\n\n      const p = prevContentIdx(tokens, i);\n      if (p >= 0) {\n        const n = nextContentIdx(tokens, i);\n        const hasNextContent = n >= 0;\n        const isEndOrPunct = nextBoundaryOrEnd(tokens, i);\n\n        const prev = tokens[p];\n        const prevSurf = prev.surface_form;\n\n        if (!prevSurf.includes(\"っ\")) {\n          if (t.pos_detail_1 === \"係助詞\") {\n            if (hasNextContent || isEndOrPunct) {\n              if (prev.pos !== \"助詞\") {\n                out += \"わ\";\n                continue;\n              }\n            }\n          }\n        }\n      }\n      out += surf;\n      continue;\n    }\n\n    // -----------------\n    // へ : direction marker (へ -> え)  ✅ 이전에 고친 로직 유지\n    // -----------------\n    if (t.pos === \"助詞\" && surf === \"へ\") {\n      const p = prevContentIdx(tokens, i);\n      if (p >= 0) {\n        const n = nextContentIdx(tokens, i);\n        const hasNextContent = n >= 0;\n        const isEndOrPunct = nextBoundaryOrEnd(tokens, i);\n\n        const prevSurf = tokens[p].surface_form;\n\n        // lexical \"...へ\" 보호 (prevSurf+へ로 보강)\n        if (LEXICAL_HE_ENDINGS.some((w) => (prevSurf + \"へ\").endsWith(w))) {\n          // keep\n        } else if (prevSurf.endsWith(\"の\")) {\n          // \"…のへ\" 보호 (지명 패턴)\n        } else if (t.pos_detail_1 === \"格助詞\") {\n          const nextPos = hasNextContent ? tokens[n].pos : \"\";\n          const looksDirectionalByVerb =\n            nextPos === \"動詞\" || nextPos === \"助動詞\";\n\n          // 가나 나열 오탐 방지: 다음 내용 토큰이 1글자 가나면 변환 금지\n          const nextSurf = hasNextContent ? tokens[n].surface_form : \"\";\n          const nextIsSingleKana = hasNextContent && isSingleKana(nextSurf);\n\n          if (!nextIsSingleKana && (looksDirectionalByVerb || isEndOrPunct)) {\n            replaced = \"え\";\n          }\n        }\n      }\n    }\n\n    // (을: 이번 턴은 안 건드림)\n\n    out += replaced;\n  }\n\n  return out;\n}\n\n// --------------------\n// Step 3: core conversion (your existing while-loop, extracted)\n// --------------------\n\nfunction coreKanaToHangulConvert(s: string): string {\n  // 테스트 요구: 특별 사전 매핑\n  const SPECIAL: Array<[string, string]> = [\n    [\"とうきょう\", \"도쿄\"],\n    [\"いいでしょうか\", \"이데쇼카\"],\n    [\"いいでしょう\", \"이데쇼\"],\n    [\"こんにちは\", \"콘니치와\"],\n    [\"こんばんは\", \"콤방와\"],\n  ];\n\n  // --- Hangul utilities ---\n  const HANGUL_BASE = 0xac00;\n  const HANGUL_END = 0xd7a3;\n\n  function isHangulSyllable(ch: string): boolean {\n    const c = ch.codePointAt(0)!;\n    return c >= HANGUL_BASE && c <= HANGUL_END;\n  }\n\n  const JONG = {\n    NONE: 0,\n    G: 1, // ㄱ\n    N: 4, // ㄴ\n    M: 16, // ㅁ\n    B: 17, // ㅂ\n    S: 19, // ㅅ\n    NG: 21, // ㅇ\n  } as const;\n\n  function addFinal(syl: string, jong: number): string {\n    if (!isHangulSyllable(syl)) return syl;\n    const code = syl.codePointAt(0)! - HANGUL_BASE;\n    const cho = Math.floor(code / 588);\n    const jung = Math.floor((code % 588) / 28);\n    return String.fromCodePoint(HANGUL_BASE + cho * 588 + jung * 28 + jong);\n  }\n\n  function replaceLastHangul(out: string, jong: number): string {\n    if (!out) return out;\n    const last = out[out.length - 1];\n    if (!isHangulSyllable(last)) return out;\n    return out.slice(0, -1) + addFinal(last, jong);\n  }\n\n  // --- Kana classification ---\n  function isHiragana(ch: string): boolean {\n    const c = ch.codePointAt(0)!;\n    return c >= 0x3040 && c <= 0x309f;\n  }\n  function isKana(ch: string): boolean {\n    return isHiragana(ch) || ch === \"ー\";\n  }\n\n  // --- Tables ---\n  type VowelMain = \"a\" | \"i\" | \"u\" | \"e\" | \"o\";\n  type ConsClass =\n    | \"vowel\"\n    | \"k\"\n    | \"s\"\n    | \"t\"\n    | \"n\"\n    | \"h\"\n    | \"m\"\n    | \"y\"\n    | \"r\"\n    | \"w\"\n    | \"g\"\n    | \"z\"\n    | \"d\"\n    | \"b\"\n    | \"p\";\n\n  type MoraInfo = {\n    out: string;\n    vowelMain: VowelMain;\n    consClass: ConsClass;\n    vowelOnly?: boolean;\n    wasYouon?: boolean;\n  };\n\n  const SINGLE: Record<string, MoraInfo> = {\n    あ: { out: \"아\", vowelMain: \"a\", consClass: \"vowel\", vowelOnly: true },\n    い: { out: \"이\", vowelMain: \"i\", consClass: \"vowel\", vowelOnly: true },\n    う: { out: \"우\", vowelMain: \"u\", consClass: \"vowel\", vowelOnly: true },\n    え: { out: \"에\", vowelMain: \"e\", consClass: \"vowel\", vowelOnly: true },\n    お: { out: \"오\", vowelMain: \"o\", consClass: \"vowel\", vowelOnly: true },\n\n    か: { out: \"카\", vowelMain: \"a\", consClass: \"k\" },\n    き: { out: \"키\", vowelMain: \"i\", consClass: \"k\" },\n    く: { out: \"쿠\", vowelMain: \"u\", consClass: \"k\" },\n    け: { out: \"케\", vowelMain: \"e\", consClass: \"k\" },\n    こ: { out: \"코\", vowelMain: \"o\", consClass: \"k\" },\n\n    さ: { out: \"사\", vowelMain: \"a\", consClass: \"s\" },\n    し: { out: \"시\", vowelMain: \"i\", consClass: \"s\" },\n    す: { out: \"스\", vowelMain: \"u\", consClass: \"s\" },\n    せ: { out: \"세\", vowelMain: \"e\", consClass: \"s\" },\n    そ: { out: \"소\", vowelMain: \"o\", consClass: \"s\" },\n\n    た: { out: \"타\", vowelMain: \"a\", consClass: \"t\" },\n    ち: { out: \"치\", vowelMain: \"i\", consClass: \"t\" },\n    つ: { out: \"츠\", vowelMain: \"u\", consClass: \"t\" },\n    て: { out: \"테\", vowelMain: \"e\", consClass: \"t\" },\n    と: { out: \"토\", vowelMain: \"o\", consClass: \"t\" },\n\n    な: { out: \"나\", vowelMain: \"a\", consClass: \"n\" },\n    に: { out: \"니\", vowelMain: \"i\", consClass: \"n\" },\n    ぬ: { out: \"누\", vowelMain: \"u\", consClass: \"n\" },\n    ね: { out: \"네\", vowelMain: \"e\", consClass: \"n\" },\n    の: { out: \"노\", vowelMain: \"o\", consClass: \"n\" },\n\n    は: { out: \"하\", vowelMain: \"a\", consClass: \"h\" },\n    ひ: { out: \"히\", vowelMain: \"i\", consClass: \"h\" },\n    ふ: { out: \"후\", vowelMain: \"u\", consClass: \"h\" },\n    へ: { out: \"헤\", vowelMain: \"e\", consClass: \"h\" },\n    ほ: { out: \"호\", vowelMain: \"o\", consClass: \"h\" },\n\n    ま: { out: \"마\", vowelMain: \"a\", consClass: \"m\" },\n    み: { out: \"미\", vowelMain: \"i\", consClass: \"m\" },\n    む: { out: \"무\", vowelMain: \"u\", consClass: \"m\" },\n    め: { out: \"메\", vowelMain: \"e\", consClass: \"m\" },\n    も: { out: \"모\", vowelMain: \"o\", consClass: \"m\" },\n\n    や: { out: \"야\", vowelMain: \"a\", consClass: \"y\" },\n    ゆ: { out: \"유\", vowelMain: \"u\", consClass: \"y\" },\n    よ: { out: \"요\", vowelMain: \"o\", consClass: \"y\" },\n\n    ら: { out: \"라\", vowelMain: \"a\", consClass: \"r\" },\n    り: { out: \"리\", vowelMain: \"i\", consClass: \"r\" },\n    る: { out: \"루\", vowelMain: \"u\", consClass: \"r\" },\n    れ: { out: \"레\", vowelMain: \"e\", consClass: \"r\" },\n    ろ: { out: \"로\", vowelMain: \"o\", consClass: \"r\" },\n\n    わ: { out: \"와\", vowelMain: \"a\", consClass: \"w\" },\n    を: { out: \"오\", vowelMain: \"o\", consClass: \"w\" },\n\n    が: { out: \"가\", vowelMain: \"a\", consClass: \"g\" },\n    ぎ: { out: \"기\", vowelMain: \"i\", consClass: \"g\" },\n    ぐ: { out: \"구\", vowelMain: \"u\", consClass: \"g\" },\n    げ: { out: \"게\", vowelMain: \"e\", consClass: \"g\" },\n    ご: { out: \"고\", vowelMain: \"o\", consClass: \"g\" },\n\n    ざ: { out: \"자\", vowelMain: \"a\", consClass: \"z\" },\n    じ: { out: \"지\", vowelMain: \"i\", consClass: \"z\" },\n    ず: { out: \"즈\", vowelMain: \"u\", consClass: \"z\" },\n    ぜ: { out: \"제\", vowelMain: \"e\", consClass: \"z\" },\n    ぞ: { out: \"조\", vowelMain: \"o\", consClass: \"z\" },\n\n    だ: { out: \"다\", vowelMain: \"a\", consClass: \"d\" },\n    ぢ: { out: \"지\", vowelMain: \"i\", consClass: \"d\" },\n    づ: { out: \"즈\", vowelMain: \"u\", consClass: \"d\" },\n    で: { out: \"데\", vowelMain: \"e\", consClass: \"d\" },\n    ど: { out: \"도\", vowelMain: \"o\", consClass: \"d\" },\n\n    ば: { out: \"바\", vowelMain: \"a\", consClass: \"b\" },\n    び: { out: \"비\", vowelMain: \"i\", consClass: \"b\" },\n    ぶ: { out: \"부\", vowelMain: \"u\", consClass: \"b\" },\n    べ: { out: \"베\", vowelMain: \"e\", consClass: \"b\" },\n    ぼ: { out: \"보\", vowelMain: \"o\", consClass: \"b\" },\n\n    ぱ: { out: \"파\", vowelMain: \"a\", consClass: \"p\" },\n    ぴ: { out: \"피\", vowelMain: \"i\", consClass: \"p\" },\n    ぷ: { out: \"푸\", vowelMain: \"u\", consClass: \"p\" },\n    ぺ: { out: \"페\", vowelMain: \"e\", consClass: \"p\" },\n    ぽ: { out: \"포\", vowelMain: \"o\", consClass: \"p\" },\n  };\n\n  const YOUON: Record<string, MoraInfo> = {\n    きゃ: { out: \"캬\", vowelMain: \"a\", consClass: \"k\", wasYouon: true },\n    きゅ: { out: \"큐\", vowelMain: \"u\", consClass: \"k\", wasYouon: true },\n    きょ: { out: \"쿄\", vowelMain: \"o\", consClass: \"k\", wasYouon: true },\n\n    しゃ: { out: \"샤\", vowelMain: \"a\", consClass: \"s\", wasYouon: true },\n    しゅ: { out: \"슈\", vowelMain: \"u\", consClass: \"s\", wasYouon: true },\n    しょ: { out: \"쇼\", vowelMain: \"o\", consClass: \"s\", wasYouon: true },\n\n    ちゃ: { out: \"챠\", vowelMain: \"a\", consClass: \"t\", wasYouon: true },\n    ちゅ: { out: \"츄\", vowelMain: \"u\", consClass: \"t\", wasYouon: true },\n    ちょ: { out: \"쵸\", vowelMain: \"o\", consClass: \"t\", wasYouon: true },\n\n    にゃ: { out: \"냐\", vowelMain: \"a\", consClass: \"n\", wasYouon: true },\n    にゅ: { out: \"뉴\", vowelMain: \"u\", consClass: \"n\", wasYouon: true },\n    にょ: { out: \"뇨\", vowelMain: \"o\", consClass: \"n\", wasYouon: true },\n\n    ひゃ: { out: \"햐\", vowelMain: \"a\", consClass: \"h\", wasYouon: true },\n    ひゅ: { out: \"휴\", vowelMain: \"u\", consClass: \"h\", wasYouon: true },\n    ひょ: { out: \"효\", vowelMain: \"o\", consClass: \"h\", wasYouon: true },\n\n    みゃ: { out: \"먀\", vowelMain: \"a\", consClass: \"m\", wasYouon: true },\n    みゅ: { out: \"뮤\", vowelMain: \"u\", consClass: \"m\", wasYouon: true },\n    みょ: { out: \"묘\", vowelMain: \"o\", consClass: \"m\", wasYouon: true },\n\n    りゃ: { out: \"랴\", vowelMain: \"a\", consClass: \"r\", wasYouon: true },\n    りゅ: { out: \"류\", vowelMain: \"u\", consClass: \"r\", wasYouon: true },\n    りょ: { out: \"료\", vowelMain: \"o\", consClass: \"r\", wasYouon: true },\n\n    ぎゃ: { out: \"갸\", vowelMain: \"a\", consClass: \"g\", wasYouon: true },\n    ぎゅ: { out: \"규\", vowelMain: \"u\", consClass: \"g\", wasYouon: true },\n    ぎょ: { out: \"교\", vowelMain: \"o\", consClass: \"g\", wasYouon: true },\n\n    じゃ: { out: \"쟈\", vowelMain: \"a\", consClass: \"z\", wasYouon: true },\n    じゅ: { out: \"쥬\", vowelMain: \"u\", consClass: \"z\", wasYouon: true },\n    じょ: { out: \"죠\", vowelMain: \"o\", consClass: \"z\", wasYouon: true },\n\n    びゃ: { out: \"뱌\", vowelMain: \"a\", consClass: \"b\", wasYouon: true },\n    びゅ: { out: \"뷰\", vowelMain: \"u\", consClass: \"b\", wasYouon: true },\n    びょ: { out: \"뵤\", vowelMain: \"o\", consClass: \"b\", wasYouon: true },\n\n    ぴゃ: { out: \"퍄\", vowelMain: \"a\", consClass: \"p\", wasYouon: true },\n    ぴゅ: { out: \"퓨\", vowelMain: \"u\", consClass: \"p\", wasYouon: true },\n    ぴょ: { out: \"표\", vowelMain: \"o\", consClass: \"p\", wasYouon: true },\n  };\n\n  const LOAN: Record<string, MoraInfo> = {\n    てぃ: { out: \"티\", vowelMain: \"i\", consClass: \"t\" },\n    でぃ: { out: \"디\", vowelMain: \"i\", consClass: \"d\" },\n    ふぁ: { out: \"파\", vowelMain: \"a\", consClass: \"p\" },\n    ふぃ: { out: \"피\", vowelMain: \"i\", consClass: \"p\" },\n    ふぇ: { out: \"페\", vowelMain: \"e\", consClass: \"p\" },\n    ふぉ: { out: \"포\", vowelMain: \"o\", consClass: \"p\" },\n  };\n\n  const SMALL_Y = new Set([\"ゃ\", \"ゅ\", \"ょ\"]);\n  const SMALL_V = new Set([\"ぁ\", \"ぃ\", \"ぅ\", \"ぇ\", \"ぉ\"]);\n\n  const U_DROP_KEYS = new Set([\n    \"ゆ\",\n    \"きゅ\",\n    \"しゅ\",\n    \"ちゅ\",\n    \"にゅ\",\n    \"ひゅ\",\n    \"みゅ\",\n    \"りゅ\",\n    \"ぎゅ\",\n    \"じゅ\",\n    \"びゅ\",\n    \"ぴゅ\",\n  ]);\n\n  type ReadMora = { key: string; len: number; info?: MoraInfo } | null;\n\n  function readMoraAt(idx: number): ReadMora {\n    if (idx >= s.length) return null;\n\n    const c0 = s[idx];\n    const c1 = s[idx + 1];\n\n    if (c1 && SMALL_V.has(c1)) {\n      const key2 = c0 + c1;\n      const info = LOAN[key2];\n      if (info) return { key: key2, len: 2, info };\n    }\n\n    if (c1 && SMALL_Y.has(c1)) {\n      const key2 = c0 + c1;\n      const info = YOUON[key2];\n      if (info) return { key: key2, len: 2, info };\n    }\n\n    const info = SINGLE[c0];\n    if (info) return { key: c0, len: 1, info };\n\n    return { key: c0, len: 1, info: undefined };\n  }\n\n  function isLabialStart(cons: ConsClass): boolean {\n    return cons === \"m\" || cons === \"b\" || cons === \"p\";\n  }\n\n  const isBoundary = (ch: string | undefined): boolean => {\n    if (!ch) return true;\n    return /\\s|[、。！？!?\\(\\)\\[\\]{}「」『』（）【】]/.test(ch);\n  };\n\n  let out = \"\";\n  let i = 0;\n\n  let lastMora: MoraInfo | null = null;\n  let leadingSokuon = false;\n\n  while (i < s.length) {\n    let matchedSpecial = false;\n    for (const [k, v] of SPECIAL) {\n      if (s.startsWith(k, i)) {\n        // SPECIAL 값도 \"가나\" 형태로 들어와야 테이블이 자연스럽게 이어짐.\n        // 여기서는 그대로 한글로 박는 기존 정책 유지.\n        out += v\n          .replaceAll(\"こんばんわ\", \"콤방와\")\n          .replaceAll(\"こんにちわ\", \"콘니치와\");\n        i += k.length;\n        lastMora = null;\n        matchedSpecial = true;\n        break;\n      }\n    }\n    if (matchedSpecial) continue;\n\n    if (s.startsWith(\"ちゃん\", i)) {\n      out += \"쨩\";\n      i += 3;\n      lastMora = { out: \"쨩\", vowelMain: \"a\", consClass: \"t\", wasYouon: true };\n      continue;\n    }\n\n    const ch = s[i];\n\n    if (ch === \"ー\") {\n      i += 1;\n      continue;\n    }\n\n    if (leadingSokuon) {\n      if (isHiragana(ch)) {\n        out += hiraToKata(ch);\n        i += 1;\n        leadingSokuon = false;\n        lastMora = null;\n        continue;\n      } else {\n        leadingSokuon = false;\n      }\n    }\n\n    if (ch === \"っ\") {\n      if (!out || !isHangulSyllable(out[out.length - 1])) {\n        out += \"ッ\";\n        i += 1;\n        leadingSokuon = true;\n        lastMora = null;\n        continue;\n      }\n\n      const next = readMoraAt(i + 1);\n      if (lastMora && lastMora.out === \"지\" && next && next.key === \"く\") {\n        i += 1;\n        continue;\n      }\n\n      const prevV = lastMora?.vowelMain ?? \"a\";\n      const nextInfo = next?.info;\n      const nextCons: ConsClass = nextInfo?.consClass ?? \"t\";\n\n      let jong: number = JONG.S;\n      if (nextCons === \"p\" || nextCons === \"b\") jong = JONG.B;\n      else if (nextCons === \"k\" || nextCons === \"g\") {\n        jong = prevV === \"e\" || prevV === \"i\" ? JONG.S : JONG.G;\n      } else {\n        jong = JONG.S;\n      }\n\n      out = replaceLastHangul(out, jong);\n      i += 1;\n      continue;\n    }\n\n    // 비가나: 그대로\n    if (!isKana(ch)) {\n      out += ch;\n      i += 1;\n      lastMora = null;\n      continue;\n    }\n\n    if (ch === \"お\" && s[i + 1] === \"お\") {\n      let j = i;\n      while (s[j] === \"お\") j++;\n      out += \"오\";\n      i = j;\n      lastMora = {\n        out: \"오\",\n        vowelMain: \"o\",\n        consClass: \"vowel\",\n        vowelOnly: true,\n      };\n      continue;\n    }\n\n    const mora = readMoraAt(i);\n    if (!mora) {\n      out += ch;\n      i += 1;\n      lastMora = null;\n      continue;\n    }\n\n    if (mora.key === \"ん\") {\n      const next = readMoraAt(i + 1);\n      const nextInfo = next?.info;\n\n      let jong: number = JONG.N;\n      const hasPrevHangul =\n        out.length > 0 && isHangulSyllable(out[out.length - 1]);\n      if (!hasPrevHangul) {\n        out += \"ㄴ\";\n        i += 1;\n        lastMora = null;\n        continue;\n      }\n\n      // ✅ \"さん\"(호칭)일 때만 '상'(받침 ㅇ)\n      // 주의: 조사 리라이트가 먼저라서 다음 글자가 'は'가 아니라 'わ'일 수 있음!\n      if (lastMora?.out === \"사\") {\n        const nextCh = s[i + 1];\n\n        const isBoundaryOrEnd =\n          !nextCh || /\\s|[、。！？!?\\(\\)\\[\\]{}「」『』（）【】]/.test(nextCh);\n\n        // 원문 조사 + 리라이트된 조사까지 모두 허용\n        const isParticleAfterSan =\n          nextCh === \"は\" ||\n          nextCh === \"へ\" ||\n          nextCh === \"を\" ||\n          nextCh === \"わ\" ||\n          nextCh === \"え\" ||\n          nextCh === \"お\";\n\n        // ✅ 핵심: \"사\" 앞에 뭔가가 있어야(-san) 인정.\n        // out는 지금 \"...사\" 까지 찍힌 상태.\n        // \"さんは\"는 out === \"사\"라서 여기서 걸러져야 함.\n        const hasPrefixBeforeSan = out.length >= 2;\n\n        // 숫자/로마자 앞도 허용해야 \"3さん\" => 3상 유지됨\n        if (hasPrefixBeforeSan && (isBoundaryOrEnd || isParticleAfterSan)) {\n          out = replaceLastHangul(out, JONG.NG); // 사 + ん => 상\n          i += 1;\n          continue;\n        }\n      }\n\n      // --- 기존 ん 규칙 ---\n      if (!next || !nextInfo || !isKana(next.key[0])) {\n        jong = lastMora?.wasYouon ? JONG.NG : JONG.N;\n      } else {\n        const nc = nextInfo.consClass;\n        if (nc === \"k\" || nc === \"g\") {\n          jong = JONG.NG;\n        } else if (nc === \"vowel\" || nc === \"y\" || nc === \"w\") {\n          jong = JONG.N;\n        } else if (isLabialStart(nc)) {\n          if (lastMora?.vowelOnly) jong = JONG.N;\n          else jong = JONG.M;\n        } else {\n          jong = JONG.N;\n        }\n      }\n\n      out = replaceLastHangul(out, jong);\n      i += 1;\n      continue;\n    }\n\n    const info = mora.info;\n    if (!info) {\n      out += mora.key;\n      i += mora.len;\n      lastMora = null;\n      continue;\n    }\n\n    out += info.out;\n    lastMora = info;\n\n    const next1 = s[i + mora.len];\n    const afterLen = s[i + mora.len + 1];\n\n    if (next1 === \"う\" && info.vowelMain === \"o\") {\n      i += mora.len + 1;\n      continue;\n    }\n\n    if (next1 === \"う\" && (mora.key === \"ゆ\" || U_DROP_KEYS.has(mora.key))) {\n      i += mora.len + 1;\n      continue;\n    }\n\n    if (next1 === \"い\") {\n      if (mora.key === \"せ\") {\n        if (afterLen !== \"な\" && afterLen !== \"か\") {\n          i += mora.len + 1;\n          continue;\n        }\n      } else if (mora.key === \"け\") {\n        if (afterLen !== \"と\") {\n          i += mora.len + 1;\n          continue;\n        }\n      } else if (mora.key === \"え\") {\n        if (afterLen !== \"こ\" && afterLen !== \"く\" && afterLen !== \"き\") {\n          i += mora.len + 1;\n          continue;\n        }\n      } else if (mora.key === \"じ\") {\n        i += mora.len + 1;\n        continue;\n      } else if (mora.key === \"き\") {\n        // \"おおきい\" 줄임 정책 유지: 뒤에 이어지면 keep\n        if (isBoundary(afterLen) || !afterLen) {\n          i += mora.len + 1;\n          continue;\n        }\n      }\n    }\n\n    if (next1 === \"え\" && mora.key === \"ね\") {\n      i += mora.len + 1;\n      continue;\n    }\n\n    i += mora.len;\n  }\n\n  return out;\n}\n"]}